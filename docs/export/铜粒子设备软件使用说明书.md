铜粒子设备软件使用说明书
软件概述
本软件是专用于铜粒子机床设备的上位控制软件，软件依赖于安装在本机的 EtherCat主站中间层。
图1.1 软件功能概览图
本软件提供如图 1.1 所示的控制/数据管理功能。在本文中将对上述的所有功能进行解释以及做出使用说明。
软件使用
本文以软件界面来分类软件功能并做出描述，本软件的界面由4 个主界面：{生产、补偿、数据、警报}以及多个用于输入/输出的对话框构成。
注意事项
夹具
当设备断电后夹具会自动夹紧，请在夹具下方无工件/其它物体时进行断电操作
当Z轴回原时会从当前位置往下移动一段距离 20~40 mm ，请注意刀具所在位置尽量不要在夹具上方进行初始化回原点操作
轴报警
当轴报警时进入 电机设置 界面中对应的轴背景回变为红色，此时需要使用上下文菜单中的 “清除轴报警”对轴报警进行清除，若报警清除无效可以选择对驱动器进行重启清除报警，并联系厂商（我们）。
驱动器重启
重启启动器前请退出软件，重启驱动器后需要在桌面的 “ProCon 控制面板”对总线服务&运控中间层进行重启。
生产
图3.1 生产界面
生产界面如图 3.1 所示，共由 位置显示、参数管理、转速&进给显示、加工指令四个部分组成。
位置显示
在该界面中展示了Tool在机床设备中位置，其中绝对位置为在机床坐标系中的位置、相对位置为Tool 以某个设定位置为原点的相对位置，工件位置为Tool在工件坐标系中的位置，剩余距离为刀具距离指令目标位置的距离。
相对原点设定
图 3.2 相对原点设定
在相对位置对应的区域内右击鼠标，会出现如图 3.2 所示的 上下文菜单，点击重置后会将Tool当前位置设备相对坐标系的原点。
机床坐标系说明
机床坐标系以外置的原点开关作为绝对参考，当工控机初次上电上位机软件首次运行必须在控制面板中使用流程控制的初始化按钮对进行初始化对各轴进行回原操作。软件仅仅保证在各轴回原后的情况下轴的位置显示准确。
图 3.3 机床坐标系
机床坐标系如图3.3 所示，当操作员在机床正前方那么三个自由度的方向和分布可以参考上图。
参数管理
图 3.4 参数显示视图
在参数显示界面中显示运动过程中回使用的一些参数，其中蓝色圈出的部分和主轴转速相关，
额定主轴X主轴缩放=主轴转速 (rpm)
绿色部分则和进给速度关联，
额定进给X进给缩放=进给速度 (mm/s)
空跑速度确定了空跑指令 FastMove 时轴的移动速度，步动增量确定了轴在步动模式下移动时单轴单次的移动量，点动速度确定了在点动模式下轴的移动速度。
参数修改
图 3.5 参数修改对话框
在参数界面右击鼠标进入如图3.5所示参数编辑对话框，在参数编辑对话框中可以对以上描述的作用于控制过程的参数进行修改，当远程应用对参数进行了修改后界面也会同步更新。
主轴转速&进给展示
图 3.6 主轴缩放&进给缩放显示
该界面中展示了实际的主轴转速和进给速度，在两个进度条中展示了 主轴缩放&进给缩放的值（百分比形式）。
加工程序
加工程序提供：指令展示、指令备份、指令重用、指令创建、指令检索等多个功能
加工程序创建
图 3.7 加工程序编写对话框
当指令队列为空时，会出现 手动添加 按钮，点击手动添加按钮会弹出加工程序创建对话框，在该对话框中操作员可以编写加工指令行程加工程序。该界面类似与代码编写IDEA ，输入一些快捷标记可以插入点位值。
表 3.1 加工程序快捷标记
快捷操作
图 3.8 指令操作上下文菜单
在加工程序界面右击/选中单个 item 后右击会弹出如图 3.7 所示的上下文菜单，
执行 项会对当前所选中的指令进行单步执行；
修改 项会进入加工程序修改对话框；
刷新 项会从指令数据源加载最新的指令数据；
清空 项会清空当前指令队列；
指令备份&重用
图 3.8 指令操作上下文菜单
点击备份按钮可对当前加工程序进行备份，备份后的程序可以在指令队列为空时点击“从程序库加载按钮”进行重用。
图 3.9 可用程序段列表
左键双击可用程序段中的程序，即可将该程序段加载到机台中进行使用。
控制面板
运动模式&IO控制
图 4.1 运动模式&IO控制按钮分布图
如图 4.1 所示，控制面板中通过响应按钮来切换运动模式以及开闭部分快捷IO。
从左至右依次为 JOG、回原、步动、手轮四个运动模式。将鼠标悬空在按钮上方同样会有提示。其余按钮就不多加描述。对于单个夹具按钮   当拨杆偏向左侧时意味着此前输出的 DO 信号为 True ，若偏向右侧则意味着DO信号输出为 False。下方的红色信号为DO 相关联的 DI信号输入，绿灯表示夹具升起，红灯表示夹具处于闭合状态。
轴控制按钮
对于轴控制按钮，需要配合运动模式一同使用，
点动模式下长按按钮对应的轴以点动速度持续移动直到按钮被松开；
步动模式下单击按钮轴移动对应的步长；
回原模式下单机轴的正向移动按钮，轴将移动到位置0处；
流程控制
图 4.2 流程控制按钮
初始化按钮
图 4.3 初始化流程图
初始化按钮对各轴进行回原操作（若上电后未在上位软件中执行回原操作），并将Z抬升到安全高度，同时修改部分软件状态（包括修改设备状态位为初始化完成）。
启动按钮
图 4.4 运行流程图
运行按钮会启动加工流程，对动作队列中的指令进行逐一执行，在整个指令执行过程中会对暂停信号和停止信号进行检查，
暂停信号有效则加工流程暂停直到使用继续按钮恢复执行，恢复执行时将执行被暂停指令的下一条指令。
停止信号有效则停止加工流程。
当单条指令执行失败，暂停信号会自动触发，此时操机员可以手动排查问题并继续执行。
暂停按钮
设置暂停信号有效，停止各轴(不包含主轴)运动，各轴的运动停止会导致指令执行失效（触发指令执行失败警报）设备状态转移为 P 暂停。
停止按钮
设置停止信号有效，停止各轴运动
继续按钮
继续按钮在指令执行失败后显示，按下该按钮会重新执行被暂停的/执行失败的指令
空运行按钮
空运行按钮会循环执行动作列表中的指令，直到手动停止/暂停，其余逻辑和运行按钮一致
设备状态转移
表2.2 控制按钮状态变换表
表4.1 设备状态转移表
补偿
图 5.1 补偿界面
补偿数据表中展示了已保存的补偿，补偿数据假设存在3 中 ，刀具几何补偿，刀具磨损补偿，工件偏移。本质上三类都是在最终移动的目标位置做一个加减。右击补偿数据表中的项后可以对补偿项进行管理、启动等操作。
图 5.2 补偿项快捷操作
已启用的补偿会出现在 “已启用补偿界面中”。保存操作会保存所有补偿项的修改。
图 5.3 已启用补偿
在已启用补偿中可以管理已经启用的补偿，同时也可以使用 “添加” 操作添加自定义类型的偏移量。所有启用的偏移量最终会进行一个线性组合施加到最终的移动位置用来修正路径。
警报
图 6.1 警报
报警界面如图 3.5 所示，可以使用上方的筛选工具对已经发生的警报进行筛选。
警报描述
表 6.1 报警状态描述
体现形式
图6.2急停警报弹窗
当设备中出现异常后，会出现弹窗来提示异常，并在部分异常弹窗中提供处理按钮。
图 6.3夹具碰撞报警
图 6.2 ，6.3 中附上了两种（夹具碰撞，急停按钮触发）系统中出现的报警弹窗。
报警处理
图6.3 报警处理流程
报警处理失败后请检查设备是否异常，给出两种可选的异常查看方法，
查看驱动器数显面板是否出现错误码
查看 电机配置界面轴项是否红色
查看总线应用实时状态
若在电机配置界面手动清除异常失效可以选择对驱动器重新上电。若未再报警窗口种对报警进行处理，可以选择再警报数据界面右击未处理的报警项目到该项目报警再次进行处理。
数据
共有三类数据 ：刀具，夹具，工件。本文中着重描述夹具刀具和工件参数略。数据的操作和其它对象类似，选中对应的数据项后右击即可操作该项目数据，也可以直接在数据表中对各种数据值进行修改。修改/添加完成后需要保存数据否则数据的插入/修改会丢失。
夹具
图 7.1 夹具数据表
夹具数据中的 MinPoint(夹紧时最小点)  ,MaxPoint(夹紧时最大点), OMinPoint(打开时最小点), OMaxPoint(打开时最大点)， 用于描述夹具开闭时夹具在坐标系中的位置。本软件将会使用此处设定的值进行夹具的碰撞检测。
刀具
图 7.2 刀具数据表
可以对添加的刀具数据进行选用，选用后刀具的直径将用于构造夹具碰撞检测的描述数据
状态展示&控制
图8.1应用状态展示
图 3.6 中时软件的状态栏，从左向右依次是：警报状态，通讯连接状态，设备状态，机台模式，页面名称，加工进度。
通讯管理
双击通讯状态UI应用将会监听设定IP的指定端口，当该端口有连接请求时软件将建立和该请求所发起设备的连接 。
右击通讯状态UI将出现可操作的上下文菜单，若想在本地操作机台不被远程干扰，可以设置取消监听/断开已经建立的通讯链接。
设置
图 9.1 设置
最大指令数量，应用协议允许的最大同时处理的指令数量(依据动作列表中的指令数量调整)
自动保存次数，系统将自动保存最近执行的加工程序段，次参数确定自动保存程序段的数量
抬刀位置，刀具（出厂80刀具）的安全位置
上料位置 {X，Y}，X,Y轴上料位置,点击控制面板中的上料按钮轴将移动刀上料位置
运动指令执行解析
动作指令目前存在三种类型 {快速移动、切割移动、IO开、IO 关闭}
快速移动
快速移动旨在让轴以最快的速度移动刀具到切削起点，在机台中手动编写时的格式为，
FastMove SX {sxVal} SY {syVal} SZ {szVal} EX {exVal} EY{eyVal} EZ {ezVal}
对于共有 6 个属性值，以 S引导的X,Y,Z 值为路径的起点 ，以 E引导的 X,Y,Z 为路劲的终点。快速移动指令以 参数管理中设定的 空跑速度 作为轴的移动速度。这6个属性值并不是必须的，你可以仅仅提供起始点位中 X,Y,Z 轴中的任意多个而不提供结束X,Y,Z。
图10.1 快速移动起点移动流程图
以上是对快速移动指令到达所设定 SX,SY,SZ 的流程描述 ，在进行起点移动时会遵循：
若SZ设定，先到位Z轴
SX,SY值若都被设定，则二轴同步移动
停止信号或暂停信号的生效会使得轴运动终止，触发指令执行失败警报
快速移动终点的运动流程类似，但是EZ 的值若设定，则Z轴会在 EX,EY到位完成后开始移动
切割移动
快速移动旨在让轴以设定的进给和主轴转速对铜板上的粒子进行稳定高效的切削，在机台中手动编写时的格式为，
FastCut SX {sxVal} SY {syVal} SZ {szVal} EX {exVal} EY{eyVal} EZ {ezVal} V {vVal} R {rVal}
共可以设置8个参数，起点的 SX,SY,SZ 的到位会以快速移动相同的指令执行到位操作，而EX,EY,EZ 的点位会以坐标系运动进行插补到位。
图10.2 切割移动流程
切割移动的流程如图6.5所示，在插补运动中会依据 EX,EY,EZ 值的设定情况开启一个 2 轴 或3 轴的插补运动。为了确保切削动作的一致性，无论EX,EY,EZ 三值设定与否只要切割移动的终点移动动作执行即即使用坐标系插补进行移动，EX,EY,EZ 中缺省的设定值使用各轴的当前位置。
夹具操作
批量开闭
夹具操作旨在运动过程中对夹具进行快速开闭，在机台中进行指令编写时遵循如下格式
SetDO/ResetDO {no1},{no2},{no3}...{noN}
图10.3 DO操作流程
机台中一共16个夹具可以在指令中对夹具进行批量操作，在开闭夹具时由于设计原因通常将夹具分为两个批次进行操作。在写完夹具的开闭信号后会等待夹具的输入信号到位，若在指定的时间内输入信号到位完成则认为夹具操作成功，可以执行下一步指令。
混合开闭
有时通过混合开闭夹具功能可以加快设备加工效率，混合开闭夹具指令的语法如下:
OpDO {no1}:{val1},{no2}:{val2},{no3}:{val3}...{noN}
图10.4 夹具分布图
夹具的开闭动作是螺旋上升/下降的，对于任意一条边的夹具中间的两个往中心旋转，两侧的两个向两侧旋转。
生产流程
图 11.1 生产流程a
%3CmxGraphModel%3E%3Croot%3E%3CmxCell%20id%3D%220%22%2F%3E%3CmxCell%20id%3D%221%22%20parent%3D%220%22%2F%3E%3CmxCell%20id%3D%222%22%20value%3D%22%E5%88%80%E5%85%B7%E5%9B%9E%E5%AE%89%E5%85%A8%E4%BD%8D%E7%BD%AE%22%20style%3D%22rounded%3D1%3BwhiteSpace%3Dwrap%3Bhtml%3D1%3BabsoluteArcSize%3D1%3BarcSize%3D14%3BstrokeWidth%3D2%3B%22%20vertex%3D%221%22%20parent%3D%221%22%3E%3CmxGeometry%20x%3D%22325%22%20y%3D%22680%22%20width%3D%22100%22%20height%3D%2240%22%20as%3D%22geometry%22%2F%3E%3C%2FmxCell%3E%3C%2Froot%3E%3C%2FmxGraphModel%3
图 11.2 生产流程 b
电机设置
图 12.1 电机设置
使用组合键盘 Shift+Ctrl+A 进入如图12.1 所示的电机设置界面。
图12.2 R轴设置项
对于如图 12.2 所示的 R轴设置项，上方的两个矩形分别为 使能信号（左），原点信号（右），当红色时说明对应的信号无效。
图12.3 轴操作上下文菜单
当轴出现报警/需要对轴进行失能/失能操作时可以右击对应的轴，在上下文菜单中对轴进行对应的报警清除、失能、失能等操作。
图 12.4 电机参数设置
若需要对软限位/轴的移动参数进行调整可以在上下文菜单中选择 “电机设置”对对应的参数进行修改
手轮参数
表 13.1 手轮移动参数表
EtherCat 通讯中间层
若设备出现异常，且软件无报警，可先点击任务栏 TrayIcon 处的的 “ProR 状态”，进行驱动器/通讯错误的查看，也可在此出处。