<!DOCTYPE html>
<html lang="zh-CN">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>导出文档</title>
<style>body{font-family:-apple-system,Segoe UI,Roboto,PingFang SC,"Microsoft YaHei",Arial,sans-serif;line-height:1.6;padding:24px;max-width:1100px;margin:auto;} p{margin:0.6em 0;} table{border-collapse:collapse;margin:10px 0;min-width:60%} th,td{border:1px solid #d1d5db;padding:6px 10px;vertical-align:top} thead{background:#f3f4f6} tr:nth-child(even){background:#fafafa}</style>
</head><body>
<p>铜粒子定位磨削系统软件开发文档</p>
<p>一、概述</p>
<p>本控制软件是针铜粒子铣床开发的上位机控制系统，具备高性能、高可靠性和良好的人机交互体验。系统采用模块化架构，集成了铜粒子路径规划、运动控制、报警管理、数据记录等核心功能，能够高效支持铜板粒子铣削任务。</p>
<p>二、系统架构与技术实现</p>
<p>1.总体结构</p>
<p>图 1.1 软件结构图</p>
<p>系统采用分层架构，主要包括：</p>
<p>硬件控制层：通过 TCP/IP协议与3D相机进行通讯，实现触发采集点云数据。</p>
<p>路径规划层：封装路径规划及气缸避让算法，实现一次采集，输出打磨路径坐标，加工数据匹配，气缸避让等多维数据包</p>
<p>业务逻辑层：封装各类报文解析、自动生成报文、运动模式、流程控制、报警检测及数据管理。</p>
<p>界面交互层：基于 winform技术实现可视化人机界面，提升操控便利性。</p>
<p>远程通讯层：通过基于 TCP 的自定义通讯协议，与机台应用系统实现高效交互。</p>
<p>远程通讯协议</p>
<p>本系统设计并实现了一套基于 TCP 协议的 高效定制通讯协议，用于上位机与机台控制系统之间的数据交换。</p>
<p>协议描述：</p>
<p>本标准的基础传输层构建在TCP/IP协议上，应用层的协议与具体的传输网络无关，应用层的具体协议详见下文。本标准与通讯介质无关。</p>
<p>应答模式</p>
<p>完整的命令由请求方发起、响应方应答组成，具体步骤如下：</p>
<p>请求方发送请求命令给响应方；</p>
<p>响应方接到请求后，向请求方发送请求应答（握手完成）；</p>
<p>请求方收到请求应答后，等待响应方回应执行结果；如果请求方未收到请求应答，按请求回应超时处理；</p>
<p>响应方执行请求操作；</p>
<p>响应方发送执行结果给请求方；</p>
<p>请求方收到执行结果，命令完成；如果请求方没有收到执行结果，按执行超时处理。</p>
<p>超时重发机制</p>
<p>一个请求命令发出后在规定的时间内未收到回应，视为超时：</p>
<p>超时后重发，重发超过规定次数后仍未收到回应视为通讯不可用，通讯结束；</p>
<p>超时时间根据具体的通讯方式和任务性质可自定义；</p>
<p>超时重发次数根据具体的通讯方式和任务性质可自定义。</p>
<p>请求方在收到请求回应后规定时间内未收到返回数据或命令执行结果，认为超时，命令执行失败，请求操作结束。</p>
<p>数据结构</p>
<p>图1 通讯协议数据结构</p>
<p>2.1 通讯包结构组成</p>
<p>表1 通讯包结构组成表</p>
<table><tbody>
<tr><td>名称</td><td>类型</td><td>长度</td><td>描述</td></tr>
<tr><td>包头</td><td>字符</td><td>2</td><td>固定为##</td></tr>
<tr><td>数据段长度</td><td>十进制整数</td><td>4</td><td>数据段的ASCII字符数，例如：长255，则写为“0255”</td></tr>
<tr><td>数据段</td><td>字符</td><td>0≤n≤1024</td></tr>
<tr><td>CRC校验</td><td>十六进制整数</td><td>4</td><td>数据段的校验结果，CRC校验算法见附录A，接收到一条命令，如果CRC错误，执行结束</td></tr>
<tr><td>包尾</td><td>字符</td><td>2</td><td>固定为&lt;CR&gt;&lt;LF&gt;(回车、换行)</td></tr>
</tbody></table>
<p>2.2 数据段结构组成</p>
<p>表2 数据段结构组成表</p>
<table><tbody>
<tr><td>名称</td><td>类型</td><td>长度</td><td>描述</td></tr>
<tr><td>请求编码QN</td><td>字符</td><td>20</td><td>精确到毫秒的时间戳：QN=YYYYMMDDhhmmsszzz，用来唯一标示一次命令交互</td></tr>
<tr><td>命令编码CN</td><td>字符</td><td>6</td><td>CN=命令编码，命令编码取值详见表6 命令编码表</td></tr>
<tr><td>Flag</td><td>整数</td><td>8</td><td>Flag=标志位，这个标志位包含标准版本号、数据是否应答。V6V5V4V3V2V1V0AV6~V0：标准版本号；Bit：000000表示本次标准修订版本号。A：命令时候应答；Bit：1-应答，0-不应答。</td></tr>
<tr><td>指令参数CP</td><td>字符</td><td>0≤n≤990</td><td>CP=&amp;&amp;数据区&amp;&amp;</td></tr>
</tbody></table>
<p>2.3 数据区</p>
<p>2.3.1 结构定义</p>
<p>字段与其值用’=’连接；在数据区中，同一项目的不同分类值用’，‘来分隔，不同项目之间用’；‘来分隔。</p>
<p>2.3.2 字段定义</p>
<p>2.3.2.1 字段名</p>
<p>字段名要区分大小写，单词的首个字符为大写，其他部分为小写。</p>
<p>2.3.2.2 数据类型</p>
<p>C4:        表示最多4位的字符型字符串，不足4位按实际位数；</p>
<p>N5:        表示最多5位的数字型字符串，不足5位按实际位数；</p>
<p>N14.2      用可变长字符串形式表达的数字型，表示14为整数和2位小数，带小数点，带符号，最大长度为18；</p>
<p>YYYY：     日期年，如2016表示2016年；</p>
<p>MM：      日期月，如09表示9月；</p>
<p>DD：       日期日，如24表示24日；</p>
<p>hh：       时间小时；</p>
<p>mm：      时间分钟；</p>
<p>ss：        时间秒；</p>
<p>zzz：       时间毫秒；</p>
<p>2.3.2.3 字段对照表</p>
<p>字段对照表如表3所示，表3中“宽度”仅包含该字段的内容长度。</p>
<p>表3 字段对照表</p>
<table><tbody>
<tr><td>字段名</td><td>描述</td><td>字符集</td><td>宽度</td><td>取值及描述</td></tr>
<tr><td>QnRtn</td><td>请求回应代码</td><td>0-9</td><td>N3</td><td>取值详见表5《请求命令返回表》</td></tr>
<tr><td>ExeRtn</td><td>执行结果回应代码</td><td>0-9</td><td>N3</td><td>取值详见表4《执行结果定义表》</td></tr>
<tr><td>D</td><td>刀具直径</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>R</td><td>刀具转速</td><td>0-9</td><td>--</td><td>单位rpm</td></tr>
<tr><td>S</td><td>行刀间距</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>H</td><td>吃刀深度</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>V</td><td>进给速度</td><td>0-9</td><td>--</td><td>单位mm/min</td></tr>
<tr><td>T</td><td>切削总深</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>I</td><td>工件表面高度</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>SX</td><td>起始点X位置</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>SY</td><td>起始点Y位置</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>SZ</td><td>起始点Z位置</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>EX</td><td>结束点X位置</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>EY</td><td>结束点Y位置</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>EZ</td><td>结束点Z位置</td><td>0-9</td><td>--</td><td>单位mm</td></tr>
<tr><td>No</td><td>第几条指令</td><td>0-9</td><td>--</td><td>表明当前指令序号。</td></tr>
<tr><td>Count</td><td>指令总数</td><td>0-9</td><td>--</td><td>表明当前机台存在待执行指令数量。</td></tr>
<tr><td>State</td><td>机台状态</td><td>A~Z</td><td>C2</td><td>第一位表明机台运行状态，R：运行；P：暂停；A：报警；F：空闲；I：初始化完成；第二位表明机台控制方式，L：本地，R：远程</td></tr>
<tr><td>DA</td><td>数据响应</td><td>0-9</td><td>C3</td><td>引用接收数据命令编码</td></tr>
<tr><td>IOBits</td><td>IO地址列</td><td>0-9&amp;A~F</td><td>C5</td><td>取值详见 附录B</td></tr>
<tr><td>CKSM</td><td>校验和</td><td>0-9&amp;A~F</td><td>C16</td><td>64位数据校验和</td></tr>
</tbody></table>
<p>代码定义</p>
<p>3.1 执行结果定义</p>
<p>表4 执行结果定义表</p>
<table><tbody>
<tr><td>编号</td><td>描述</td><td>备注</td></tr>
<tr><td>1</td><td>执行成功</td></tr>
<tr><td>2</td><td>执行失败，但不知道原因</td></tr>
<tr><td>3</td><td>命令请求条件错误</td></tr>
<tr><td>4</td><td>通讯超时</td></tr>
<tr><td>5</td><td>系统繁忙不能执行</td></tr>
<tr><td>6</td><td>系统故障</td></tr>
<tr><td>100</td><td>没有数据</td></tr>
</tbody></table>
<p>3.2 请求命令返回</p>
<p>请求命令返回如表5所示。</p>
<p>表5 请求命令返回表</p>
<table><tbody>
<tr><td>编号</td><td>描述</td><td>备注</td></tr>
<tr><td>1</td><td>准备执行请求</td></tr>
<tr><td>2</td><td>请求被拒绝</td></tr>
<tr><td>3</td><td>Flag错误</td></tr>
<tr><td>4</td><td>QN错误</td></tr>
<tr><td>5</td><td>CN错误</td></tr>
<tr><td>6</td><td>CRC检验错误</td></tr>
<tr><td>100</td><td>未知错误</td></tr>
</tbody></table>
<p>3.3 命令编码（可扩充）</p>
<p>对应“图4通讯协议数据结构”中的命令编码。</p>
<p>3.3.1 类别划分</p>
<p>共有四类命令（即请求命令、上传命令、通知命令和交互命令），命令编码分为以下四组：</p>
<p>100~199表示初始化命令和参数命令编码；</p>
<p>200~299表示数据命令编码；</p>
<p>300~399表示控制命令编码；</p>
<p>900~999表示交互命令编码。</p>
<p>3.3.2 命令编码方法</p>
<p>命令编码用3为阿拉伯数字表示，如表6所示。</p>
<p>表6 命令编码表</p>
<table><tbody>
<tr><td>命令名称</td><td>命令编码</td><td>命令类型</td><td>描述</td></tr>
<tr><td></td><td>上位向机台</td><td>机台向上位</td></tr>
<tr><td>初始化命令</td></tr>
<tr><td>设备初始化</td><td>100</td><td></td><td>请求命令</td><td>用于上位机通知现场机执行初始化动作</td></tr>
<tr><td>预留初始化命令</td><td></td><td></td><td></td><td>预留命令范围101-110</td></tr>
<tr><td>参数命令</td></tr>
<tr><td>查询机台工艺参数</td><td>111</td><td></td><td>请求命令</td><td>用于提取机台的工艺参数</td></tr>
<tr><td>上传机台工艺参数</td><td></td><td>111</td><td>上传命令</td><td>用于上传机台的工艺参数</td></tr>
<tr><td>设置机台工艺参数</td><td>112</td><td></td><td>请求命令</td><td>用于设置机台的工艺参数</td></tr>
<tr><td>预留参数命令</td><td></td><td></td><td></td><td>预留命令范围113-199</td></tr>
<tr><td>数据命令</td></tr>
<tr><td>取机台状态</td><td>201</td><td></td><td>请求命令</td><td>用于启动机台上传运行状态</td></tr>
<tr><td>上传机台状态</td><td></td><td>201</td><td>上传命令</td><td>用于机台上传当前设备状态</td></tr>
<tr><td>停止查看机台状态</td><td>202</td><td></td><td>通知命令</td><td>用于停止机台上传运行状态</td></tr>
<tr><td>取机台动作列表</td><td>203</td><td></td><td>请求命令</td><td>用于查询机台待执行的动作列表</td></tr>
<tr><td>清除机台动作</td><td>204</td><td></td><td>请求命令</td><td>用于删除之前添加的指令动作，当No=-1的情况下，删除所有指令动作。</td></tr>
<tr><td>查询DI状态列表</td><td>205</td><td></td><td>请求命令</td><td>用于查看机台DI状态，使用IOBits表明要查询的DI地址。</td></tr>
<tr><td>查询动作校验和</td><td>206</td><td></td><td>请求命令</td><td>查询机台中动作列表所生成的校验和</td></tr>
<tr><td>添加指令</td></tr>
<tr><td>快速移动</td><td>210</td><td></td><td>请求命令</td></tr>
<tr><td></td><td></td><td>210</td><td>上传命令</td><td>用于回复上位机的指令查询</td></tr>
<tr><td>切割移动</td><td>211</td><td></td><td>请求命令</td></tr>
<tr><td></td><td></td><td>211</td><td>上传命令</td><td>用于回复上位机的指令查询</td></tr>
<tr><td>DO开</td><td>212</td><td></td><td>请求命令</td></tr>
<tr><td></td><td></td><td>212</td><td>上传命令</td><td>用于回复上位机的指令查询</td></tr>
<tr><td>DO关</td><td>213</td><td></td><td>请求命令</td></tr>
<tr><td></td><td></td><td>213</td><td>上传命令</td><td>用于回复上位机的指令查询</td></tr>
<tr><td>预留数据命令</td><td></td><td></td><td></td><td>预留命令范围214~299</td></tr>
<tr><td>控制命令</td></tr>
<tr><td>执行动作</td><td>301</td><td></td><td>请求命令</td><td>用于上位机启动机台按照添加的指令动作进行执行。</td></tr>
<tr><td>暂停动作</td><td>302</td><td></td><td>请求命令</td><td>用于上位机暂停当前机台的指令动作。</td></tr>
<tr><td>DO开</td><td>303</td><td></td><td>请求命令</td><td>用于上位机控制机台打开IOBits中指定的DO</td></tr>
<tr><td>DO关</td><td>304</td><td></td><td>请求命令</td><td>用于上位机控制机台关闭IOBits中指定的DO</td></tr>
<tr><td>全部夹紧</td><td>305</td><td></td><td>请求命令</td><td>用于上位机机控制机台打开所有夹具</td></tr>
<tr><td>全部松开</td><td>306</td><td></td><td>请求命令</td><td>用于上位机机控制机台关闭所有夹具</td></tr>
<tr><td>停止</td><td>307</td><td></td><td>请求命令</td><td>用于上位机控制机台停止生产流程</td></tr>
<tr><td>预留控制命令</td><td></td><td></td><td></td><td>预留命令范围308~399</td></tr>
<tr><td>交互命令</td></tr>
<tr><td>请求应答</td><td></td><td>901</td><td></td><td>用于机台回应接收的上位机请求命令是否有效</td></tr>
<tr><td>执行结果</td><td></td><td>902</td><td></td><td>用于机台回应接收的上位机请求命令执行结果</td></tr>
<tr><td>通知应答</td><td>903</td><td>903</td><td></td><td>回应通知命令</td></tr>
<tr><td>数据应答</td><td>904</td><td>904</td><td></td><td>数据应答命令</td></tr>
<tr><td>预留交互命令</td><td></td><td></td><td></td><td>预留命令范围905~999</td></tr>
</tbody></table>
<p>请求顺序</p>
<p>图2 请求顺序图</p>
<p>通讯命令示例和拆分包及应答机制示例</p>
<p>表7 设备初始化</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “设备初始化”</td><td>QN=20241231115731779;CN=100;Flag=1;CP=&amp;&amp;&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20241231115731779;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20241231115731779;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td>执行过程</td><td>上位机发送 “设备初始化”命令； 机台检查请求报文并返回请求应答；3、机台接收“设备初始化”命令并执行 设备初始化流程； 4、机台完成设备初始化流程后返回“执行结果”；5、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表8设置机台工艺参数</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “设置机台工艺参数”</td><td>QN=20241231133614817;CN=112;Flag=1;CP=&amp;&amp;D=71.189,H=43.206,V=7.811,S=26.761,R=45.826&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20241231133614817;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20241231133614817;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td></td><td>D</td><td>刀具直径</td></tr>
<tr><td></td><td>H</td><td>切削总深</td></tr>
<tr><td></td><td>V</td><td>进给速度</td></tr>
<tr><td></td><td>S</td><td>⾏刀间距</td></tr>
<tr><td></td><td>R</td><td>刀具转速</td></tr>
<tr><td>执行过程</td><td>上位机发送 “设置机台工艺参数”命令； 2、机台检查请求报文并返回请求应答；3、机台接收“设置机台工艺参数”命令并执行设置机台工艺参数流程； 4、机台完成工艺参数设置后返回“执行结果”；5、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表9 查询机台工艺参数</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “查询机台工艺参数”命令</td><td>QN=20241231133903587;CN=111;Flag=1;CP=&amp;&amp;&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20241231133903587;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“工艺参数”</td><td>QN=20241231133903587;CN=111;Flag=0;CP=&amp;&amp;CP=&amp;&amp;D=71.189,H=43.206,V=7.811,S=26.761,R=45.826&amp;&amp;</td></tr>
<tr><td></td><td>上位机</td><td>返回“数据应答”</td><td>QN=20241231133903587;CN=904;Flag=0;CP=&amp;&amp;DA=000111&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20241231133903587;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td></td><td>D</td><td>刀具直径</td></tr>
<tr><td></td><td>H</td><td>切削总深</td></tr>
<tr><td></td><td>V</td><td>进给速度</td></tr>
<tr><td></td><td>S</td><td>行刀间距</td></tr>
<tr><td></td><td>R</td><td>刀具转速</td></tr>
<tr><td></td><td>D</td><td>刀具直径</td></tr>
<tr><td></td><td>DA</td><td>应答数据类型</td></tr>
<tr><td>执行过程</td><td>1、上位机发送 “查询机台工艺参数”命令； 2、机台接收“查询机台工艺参数”命令并返回请求应答； 3、机台上传本地的工艺参数并开始等待上位机的数据应答；4、上位机接收“工艺参数列表后”，返回应答的数据应答；5、机台接受到数据应答后，返回执行结果；6、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表10 添加执行动作</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “快速移动”/“切割移动”</td><td>QN=20241231134233533;CN=210;Flag=0;CP=&amp;&amp;SX=24.450,SY=41.353,SZ=77.725,EX=7.679,EY=97.946,EZ=61.347&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20241231134233533;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20241231134233533;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td></td><td>SX</td><td>起始点 X 位置</td></tr>
<tr><td></td><td>SY</td><td>起始点 Y 位置</td></tr>
<tr><td></td><td>SZ</td><td>起始点Z位置</td></tr>
<tr><td></td><td>EX</td><td>结束点 X 位置</td></tr>
<tr><td></td><td>EY</td><td>结束点 Y位置</td></tr>
<tr><td></td><td>EZ</td><td>结束点 Z 位置</td></tr>
<tr><td>执行过程</td><td>上位机发送 “快速移动”/“切割移动”命令； 机台检查请求报文并返回请求应答；3、“快速移动”/“切割移动”被添加到机台的待执行动作列表； 4、机台返回“执行结果”；5、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表11查询动作列表</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “查询动作列表”</td><td>QN=20241231134344169;CN=203;Flag=1;CP=&amp;&amp;&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20241231134344169;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>上传“快速移动”</td><td>QN=20241231134344169;CN=000210;Flag=0;CP=&amp;&amp;SX=24.450,SY=41.353,SZ=77.725,EX=7.679,EY=97.946,EZ=61.347,NO=0&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>上传“切割移动”</td><td>QN=20241231134344169;CN=000211;Flag=0;CP=&amp;&amp;SX=97.091,SY=71.921,SZ=29.566,EX=76.677,EY=85.985,EZ=83.485,NO=1&amp;&amp;</td></tr>
<tr><td></td><td>上位机</td><td>返回“数据应答”</td><td>QN=20241231134344169;CN=904;Flag=0;CP=&amp;&amp;DA=210;NO=0&amp;&amp;</td></tr>
<tr><td></td><td>上位机</td><td>返回“数据应答”</td><td>QN=20241231134344169;CN=904;Flag=0;CP=&amp;&amp;DA=211;NO=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20241231134344169;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td></td><td>SX</td><td>起始点 X 位置</td></tr>
<tr><td></td><td>SY</td><td>起始点 Y 位置</td></tr>
<tr><td></td><td>SZ</td><td>起始点Z位置</td></tr>
<tr><td></td><td>EX</td><td>结束点 X 位置</td></tr>
<tr><td></td><td>EY</td><td>结束点 Y位置</td></tr>
<tr><td></td><td>EZ</td><td>结束点 Z 位置</td></tr>
<tr><td></td><td>DA</td><td>应答数据类型</td></tr>
<tr><td></td><td>NO</td><td>表明当前指令的执行序号</td></tr>
<tr><td>执行过程</td><td>1、上位机发送 “查询动作列表”命令； 2、机台接收“查询动作列表”命令并返回请求应答； 3、机台依次上传本地的所有带执行动作；4、上位机接收设备上传的所有的“快速移动”/“切割移动”，返回数据应答；5、机台接受到所有数据应答后，返回执行结果；6、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表12执行动作</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “执行动作”指令</td><td>QN=20250107193416210;CN=301;Flag=0;CP=&amp;&amp;&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20250107193416210;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20250107193416210;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td>执行过程</td><td>上位机发送 “执行动作”命令； 2、机台检查请求报文并返回请求应答；2、机台接收“执行动作”命令并依据自身状态判断是否执行，若允许执行则开始执行并返回请求结果，若不能执行则返回相应（系统繁忙/故障）的执行代码； 4、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表8暂停动作</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “暂停动作”</td><td>QN=20250107175100769;CN=302;Flag=0;CP=&amp;&amp;&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20250107175100769;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20250107175100769;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td>执行过程</td><td>上位机发送 “暂停动作”命令； 2、机台检查请求报文并返回请求应答；3、机台停止生产流程3、返回执行结果4、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表9清除动作</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “清除机台动作”</td><td>QN=20250107193646591;CN=204;Flag=1;CP=&amp;&amp;NO=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20250107193646591;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20250107193646591;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td></td><td>NO</td><td>需要删除的指令序号</td></tr>
<tr><td>执行过程</td><td>上位机发送 “清除机台动作”命令；2、机台检查请求报文并返回请求应答； 3、依据指令中的NO对待执行动作队列中的运动指令进行删除3、返回执行结果4、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表 10 追加DO 开</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “追加DO开”</td><td>QN=20250208170508745;CN=212;Flag=0;CP=&amp;&amp;IOBits=10F01&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20250208170508745;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20250208170508745;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td></td><td>IOBits</td><td>需要关闭的 4*5(5个HEX字符) 个 IO的地址列表，当对应编号的bit值为1时则表示在该DO输出打开信号</td></tr>
<tr><td>执行过程</td><td>上位机发送 “追加DO开”命令； 2、机台检查请求报文并返回请求应答； 2、机台将该IO指令追加到动作执行队列3、返回执行结果4、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表 11 追加DO 关</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “追加DO关”</td><td>QN=20250208170508745;CN=213;Flag=0;CP=&amp;&amp;IOBits=10F01&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20250208170508745;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20250208170508745;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td></td><td>IOBits</td><td>IO地址列表</td></tr>
<tr><td>执行过程</td><td>上位机发送 “追加DO关”命令； 2、机台检查请求报文并返回请求应答；3、机台将该IO指令追加到动作执行队列3、返回执行结果4、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表 12 DO开</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “DO开”</td><td>QN=20250208171123414;CN=303;Flag=0;CP=&amp;&amp;IOBits=0EF21&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20250208171123414;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20250208171123414;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td></td><td>IOBits</td><td>IO地址列表</td></tr>
<tr><td>执行过程</td><td>1、上位机发送 “DO开”命令； 2、机台检查请求报文并返回请求应答；3、机台依据指定的0~n 个有效的DO地址进行DO开操作4、返回执行结果5、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表 13 DO关</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “DO关”</td><td>QN=20250208171830972;CN=304;Flag=0;CP=&amp;&amp;IOBits=10101&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20250208171830972;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20250208171830972;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td></td><td>IOBits</td><td>IO地址列表</td></tr>
<tr><td>执行过程</td><td>上位机发送 “追加DO关”命令； 2、机台检查请求报文并返回请求应答；3、机台依据指定的0~n 个有效的DO地址进行DO关闭操作4、返回执行结果5、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>表 14 查询设备DI状态列表</p>
<table><tbody>
<tr><td>类别</td><td>项目</td><td>示例/说明</td></tr>
<tr><td>使用命令</td><td>上位机</td><td>发送 “取DI列表”命令</td><td>QN=20250208171945129;CN=205;Flag=1;CP=&amp;&amp;IOBits=FFFFF&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“请求应答”</td><td>QN=20250208171945129;CN=901;Flag=0;CP=&amp;&amp;QnRtn=1&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>上传上位机查询的的设备IO状态</td><td>QN=20250208171945129;CN=205;Flag=0;CP=&amp;&amp;IOBits=0EE20&amp;&amp;</td></tr>
<tr><td></td><td>上位机</td><td>对设备上传的DI状态列表进行数据响应</td><td>QN=20250208171945129;CN=904;Flag=0;CP=&amp;&amp;DA=205&amp;&amp;</td></tr>
<tr><td></td><td>机台</td><td>返回“执行结果”</td><td>QN=20250208171945129;CN=902;Flag=0;CP=&amp;&amp;ExeRtn=1&amp;&amp;</td></tr>
<tr><td>使用字段</td><td>QnRtn</td><td>请求应答结果</td></tr>
<tr><td></td><td>ExeRtn</td><td>请求执行结果</td></tr>
<tr><td></td><td>IOBits</td><td>IO地址列表</td></tr>
<tr><td></td><td>DA</td><td>数据响应</td></tr>
<tr><td>执行过程</td><td>1、上位机发送 “查询DI列表”命令； 2、机台接收命令并返回请求应答3、返回执行结果4、上位机接收“执行结果”，根据执行结果标志 ExeRtn 的值判断请求是否完成，请求执行完毕；</td></tr>
</tbody></table>
<p>附 录 A</p>
<p>（规范性附录）</p>
<p>循环冗余校验（CRC）算法</p>
<p>CRC校验（Cyclic Redundancy Check）是一种数据传输错误检查方法。本标准采用ANSI CRC16， 简称CRC16。</p>
<p>CRC16 码由传输设备计算后加入到数据包中。接收设备重新计算接收数据包的CRC16码，并与接 收到的CRC16码比较，如果两值不同，则有误。</p>
<p>CRC16 校验字节的生成步骤如下：</p>
<p>1) CRC16 校验寄存器赋值为0xFFFF；</p>
<p>2) 取被校验串的第一个字节赋值给临时寄存器；</p>
<p>3) 临时寄存器与CRC16校验寄存器的高位字节进行“异或”运算，赋值给CRC16校验寄存器；</p>
<p>4) 取CRC16校验寄存器最后一位赋值给检测寄存器；</p>
<p>5) 把CRC16校验寄存器右移一位；</p>
<p>6) 若检测寄存器值为1，CRC16校验寄存器与多项式0xA001进行“异或”运算，赋值给CRC16 校验寄存器；</p>
<p>7) 重复步骤4~6，直至移出8位；</p>
<p>8) 取被校验串的下一个字节赋值给临时寄存器；</p>
<p>9) 重复步骤3~8，直至被校验串的所有字节均被校验；</p>
<p>10) 返回CRC16校验寄存器的值。 校验码按照先高字节后低字节的顺序存放。</p>
<p>CRC校验算法示例：</p>
<p>/****************************************************************************************</p>
<p>函 数: CRC16_Checkout</p>
<p>描 述: CRC16循环冗余校验算法。</p>
<p>参 数 一: *puchMsg：需要校验的字符串指针</p>
<p>参 数 二: usDataLen：要校验的字符串长度</p>
<p>返 回 值: 返回CRC16校验码</p>
<p>****************************************************************************************/</p>
<p>附 录 B</p>
<p>IO设备取值说明</p>
<p>使用5位16进制来对IO设备进行编址，每位16进制可以表示4个IO设备 4*5 即共可表示20个IO设备。</p>
<p>表1机台IO设备编址</p>
<table><tbody>
<tr><td>编号</td><td>值(16进制字符串)</td><td>含义</td></tr>
<tr><td>0</td><td>0X00001</td><td>气缸1</td></tr>
<tr><td>1</td><td>0X00002</td><td>气缸2</td></tr>
<tr><td>2</td><td>0X00004</td><td>气缸3</td></tr>
<tr><td>3</td><td>0X00008</td><td>气缸4</td></tr>
<tr><td>4</td><td>0X00010</td><td>气缸5</td></tr>
<tr><td>5</td><td>0X00020</td><td>气缸6</td></tr>
<tr><td>6</td><td>0X00040</td><td>气缸7</td></tr>
<tr><td>7</td><td>0X00080</td><td>气缸8</td></tr>
<tr><td>8</td><td>0X00100</td><td>气缸9</td></tr>
<tr><td>9</td><td>0X00200</td><td>气缸10</td></tr>
<tr><td>10</td><td>0X00400</td><td>气缸11</td></tr>
<tr><td>11</td><td>0X00800</td><td>气缸12</td></tr>
<tr><td>12~19</td><td></td><td>预留IO地址</td></tr>
</tbody></table>
<p>允许同时操控多个DO设备，例如若需要打开气缸 1~12 可以使用 位运算 ‘|’对各个气缸IO的地址值进行连接运算。</p>
<p>查询DI列表时同理，指令可以仅仅查询关注的0~n|{n&lt;20} 个DI信号，例如需要查询气缸 {2,6,8}</p>
<p>UI界面设计</p>
<p>图3 界面效果图</p>
<p>人机交互界面因具备如下基本功能：</p>
<p>因能显示3D相机实时画面，及触发后的路径规划图。</p>
<p>因能直观的显示机台当前状态，后台以轮训的形式获取机台状态，当机台异常时，应能采取相关连锁机制，禁止触发和远控的相关功能，确保安全。</p>
<p>如图所示：</p>
<p>应能统计打磨总数，打磨耗时，等相关统计数据，</p>
<p>需要显示当前配方；</p>
<p>需要输出日志及报警信息（包括但不限于监测机台异常状态及软件本身报警）；</p>
<p>需要具备离线调试功能；</p>
<p>需要具备通讯测试功能；</p>
<p>需要具备系统参数设置功能；</p>
<p>需要具备配方管理功能；</p>
<p>需要具备打磨数据统计功能，输出表格功能；</p>
<p>后台交互逻辑：</p>
</body></html>